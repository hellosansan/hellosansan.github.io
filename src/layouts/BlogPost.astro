---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import { slugify } from "../utils/slugify";
let {
  content: { title, added, updated, tags, description },
} = Astro.props;
added = new Date(added).toISOString().slice(0, 10);
if (updated) {
  updated = new Date(updated).toISOString().slice(0, 10);
}
---

<html lang="zh-cn">
  <BaseHead title={title} pageType="post" />

  <body id="top">
    <main>
      <h1>{title}</h1>

      <div
        class="vice"
        style="text-align: center; font-size: 1.2em; width: 90%; margin: -1.0em auto 0.2em auto"
      >
        {description}
      </div>

      <div class="vice" style="text-align: center; margin: 0.6em auto 0 auto">
      
        {
          tags.map((tag: string, i: number) => (
            <span>
              {i > 0 && " / "}
              <a href={`/tag/${slugify(tag)}`} style="color: inherit; text-decoration: none;">
                {tag}
              </a>
  
            </span>
          ))
        }
      </div>

      <div class="vice" style="text-align: center">
        {
          updated && updated !== added ?
          (
            <span>
              <time>{added}</time> (<time>{updated}</time>)
            </span>
          ) : (
            <span>{added && <time>{added}</time>}</span>
          )
        }
      </div>

      <hr style="margin: 1.4em 0 1.4em 0;" />

      <slot />

      <Footer />
    </main>
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // 同时选择段落（可能是格言）和图片容器（.image-wrap）
    // 这里的 querySelectorAll 会按照它们在 HTML 中出现的顺序返回列表
    const candidates = document.querySelectorAll("p, .image-wrap");
    
    // 统一计数器：无论是格言还是图片，都共用这个计数器来决定左右
    let floatCounter = 0;

    candidates.forEach((el) => {
      let isFloatingElement = false;

      // 逻辑 1: 检查是否为格言 (Epigraph)
      // 只有当元素是 P 标签且包含『』时才判定为格言
      if (el.tagName === "P") {
        const trimmedText = el.textContent.trim();
        if (trimmedText.startsWith("『") && trimmedText.endsWith("』")) {
          el.classList.add("epigraph");
          isFloatingElement = true;
        }
      }
      
      // 逻辑 2: 检查是否为图片容器 (Image Wrap)
      // 假设你的 markdown 插件生成的图片容器带有 .image-wrap 类
      else if (el.classList.contains("image-wrap")) {
        isFloatingElement = true;
        // 移除可能由服务端/插件预设的浮动类，确保完全由这里控制交替逻辑
        el.classList.remove("float-left", "float-right");
      }

      // 统一应用左右交替规则
      if (isFloatingElement) {
        if (floatCounter % 2 === 0) {
          // 偶数：左浮动
          el.classList.add("float-left");
        } else {
          // 奇数：右浮动
          el.classList.add("float-right");
        }
        // 只有确认为悬挂元素时，计数器才增加
        floatCounter++;
      }
    });
  });
</script>
